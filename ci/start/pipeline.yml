---
resources:
- name: version
  type: semver
  source:
    driver: git
    initial_version: 0.0.0
    uri: ((ranger6-git-url))
    branch: version
    file: version
    private_key: ((ranger6-git-private-key))

- name: config
  type: git
  source:
    uri: ((ranger6-git-url))
    branch: version
    paths:
    - "release-config.json"
    private_key: ((ranger6-git-private-key))

- name: develop
  type: git
  source:
    uri: ((ranger6-git-url))
    branch: develop
    private_key: ((ranger6-git-private-key))

- name: release
  type: git
  source:
    uri: ((ranger6-git-url))
    branch: develop
    private_key: ((ranger6-git-private-key))

jobs:
- name: start-release
  public: true
  plan:
  - get: config
    trigger: true
  - get: develop
  - load_var: release-config
    file: config/release-config.json
    format: json
    reveal: true
  - get: version
    params: {bump: ((.:release-config.release-level))}
  - task: start
    file: develop/ci/start/start.yml
  - load_var: branch-config
    file: branch/branch-config.json
  - put: version
    params: {bump: ((.:release-config.release-level))}
  - put: release
    params:
        repository: release
        branch: ((.:branch-config.release-branch-name))
  - set_pipeline: prepare-release
    file: release/ci/pipeline.yml
    vars:
        release-branch: "((.:branch-config.release-branch-name))"
